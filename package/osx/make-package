#!/bin/bash

set -e

PACKAGE_DIR=`pwd`

if [ "$1" == "clean" ]
then
   # remove existing build dir
   rm -rf build
   
   # clean out ant build
   cd ../../src/gwt
   ant clean
   cd $PACKAGE_DIR
fi

# use qtsdk built from source if available
if [ -e /usr/local/Trolltech/Qt-4.8.0/bin/qmake ]; then
  QMAKE="-DQT_QMAKE_EXECUTABLE=/usr/local/Trolltech/Qt-4.8.0/bin/qmake"
fi

mkdir -p build
cd build
rm -f CMakeCache.txt
rm -rf build/_CPack_Packages

cmake -DRSTUDIO_TARGET=Desktop \
      -DCMAKE_BUILD_TYPE=Release \
      -DRSTUDIO_PACKAGE_BUILD=1 \
      ${QMAKE} ../../..

make

cpack -G DragNDrop

cd ..
