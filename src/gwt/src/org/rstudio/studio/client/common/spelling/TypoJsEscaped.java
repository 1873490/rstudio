/*
 * TypoJsEscaped.js
 *
 * Copyright (C) 2009-19 by RStudio, Inc.
 *
 * Unless you have received this program directly from RStudio pursuant
 * to the terms of a commercial license agreement with RStudio, then
 * this program is licensed to you under the terms of version 3 of the
 * GNU Affero General Public License. This program is distributed WITHOUT
 * ANY EXPRESS OR IMPLIED WARRANTY, INCLUDING THOSE OF NON-INFRINGEMENT,
 * MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. Please refer to the
 * AGPL (http://www.gnu.org/licenses/agpl-3.0.txt) for more details.
 *
 */

package org.rstudio.studio.client.common.spelling;

// This is the compressed version of the typo.js that shares the package with this file.
// If Typo.js is ever altered or updated this file will also need to be updated. Any reasonable
// Minifier/Compressor is fine, this is only for the PrefetchWorker to run.
public class TypoJsEscaped
{
   public static final String typoJsCode = "var Typo;!function(){(Typo=function(e,s,r,o){o=o||{},this.inputwords=\"\",this.outputwords=\"\",this.dictionary=null,this.rules={},this.dictionaryTable={},this.compoundRules=[],this.compoundRuleCodes={},this.replacementTable=[],this.flags=o.flags||{},this.memoized={},this.loaded=!1;var t,a,l,u,c,h=this;function n(e,t){var n=h._readFile(e,null,o.asyncLoad);o.asyncLoad?n.then(function(e){t(e)}):t(n)}function i(e){s=e,r&&p()}function f(e){r=e,s&&p()}function p(){for(h.rules=h._parseAFF(s),h.compoundRuleCodes={},a=0,u=h.compoundRules.length;a<u;a++){var e=h.compoundRules[a];for(l=0,c=e.length;l<c;l++)h.compoundRuleCodes[e[l]]=[]}for(a in\"ONLYINCOMPOUND\"in h.flags&&(h.compoundRuleCodes[h.flags.ONLYINCOMPOUND]=[]),h.dictionaryTable=h._parseDIC(r),h.compoundRuleCodes)0===h.compoundRuleCodes[a].length&&delete h.compoundRuleCodes[a];for(a=0,u=h.compoundRules.length;a<u;a++){var t=h.compoundRules[a],n=\"\";for(l=0,c=t.length;l<c;l++){var i=t[l];i in h.compoundRuleCodes?n+=\"(\"+h.compoundRuleCodes[i].join(\"|\")+\")\":n+=i}h.compoundRules[a]=new RegExp(n,\"i\")}h.loaded=!0,o.asyncLoad&&o.loadedCallback&&o.loadedCallback(h)}return e&&(h.dictionary=e,s&&r?p():\"undefined\"!=typeof window&&\"chrome\"in window&&\"extension\"in window.chrome&&\"getURL\"in window.chrome.extension?(t=o.dictionaryPath?o.dictionaryPath:\"typo/dictionaries\",s||n(chrome.extension.getURL(t+\"/\"+e+\"/\"+e+\".aff\"),i),r||n(chrome.extension.getURL(t+\"/\"+e+\"/\"+e+\".dic\"),f)):(t=o.dictionaryPath?o.dictionaryPath:\"undefined\"!=typeof __dirname?__dirname+\"/dictionaries\":\"./dictionaries\",s||n(t+\"/\"+e+\"/\"+e+\".aff\",i),r||n(t+\"/\"+e+\"/\"+e+\".dic\",f))),this}).prototype={load:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);return this},_readFile:function(e,t,n){if(t=t||\"utf8\",\"undefined\"!=typeof XMLHttpRequest){var i,s=new XMLHttpRequest;return s.open(\"GET\",e,n),n&&(i=new Promise(function(e,t){s.onload=function(){200===s.status?e(s.responseText):t(s.statusText)},s.onerror=function(){t(s.statusText)}})),s.overrideMimeType&&s.overrideMimeType(\"text/plain; charset=\"+t),s.send(null),n?i:s.responseText}if(\"undefined\"!=typeof require){var r=require(\"fs\");try{if(r.existsSync(e)){var o=r.statSync(e),a=r.openSync(e,\"r\"),l=new Buffer(o.size);return r.readSync(a,l,0,l.length,null),l.toString(t,0,l.length)}console.log(\"Path \"+e+\" does not exist.\")}catch(e){return console.log(e),\"\"}}},_parseAFF:function(e){var t,n,i,s,r,o,a,l={},u=(e=this._removeAffixComments(e)).split(\"\\n\");for(s=0,o=u.length;s<o;s++){var c=(t=u[s]).split(/\\s+/),h=c[0];if(\"PFX\"==h||\"SFX\"==h){var f=c[1],p=c[2],d=[];for(a=(r=s+1)+(n=parseInt(c[3],10));r<a;r++){var m=(i=u[r].split(/\\s+/))[2],g=i[3].split(\"/\"),v=g[0];\"0\"===v&&(v=\"\");var y=this.parseRuleCodes(g[1]),C=i[4],R={};R.add=v,0<y.length&&(R.continuationClasses=y),\".\"!==C&&(R.match=\"SFX\"===h?new RegExp(C+\"$\"):new RegExp(\"^\"+C)),\"0\"!=m&&(R.remove=\"SFX\"===h?new RegExp(m+\"$\"):m),d.push(R)}l[f]={type:h,combineable:\"Y\"==p,entries:d},s+=n}else if(\"COMPOUNDRULE\"===h){for(a=(r=s+1)+(n=parseInt(c[1],10));r<a;r++)i=(t=u[r]).split(/\\s+/),this.compoundRules.push(i[1]);s+=n}else\"REP\"===h?3===(i=t.split(/\\s+/)).length&&this.replacementTable.push([i[1],i[2]]):this.flags[h]=c[1]}return l},_removeAffixComments:function(e){return e=(e=(e=(e=e.replace(/^\\s*#.*$/gm,\"\")).replace(/^\\s\\s*/m,\"\").replace(/\\s\\s*$/m,\"\")).replace(/\\n{2,}/g,\"\\n\")).replace(/^\\s\\s*/,\"\").replace(/\\s\\s*$/,\"\")},_parseDIC:function(e){var t=(e=this._removeDicComments(e)).split(\"\\n\"),n={};function i(e,t){n.hasOwnProperty(e)||(n[e]=null),0<t.length&&(null===n[e]&&(n[e]=[]),n[e].push(t))}for(var s=1,r=t.length;s<r;s++){var o=t[s];if(o){var a=o.split(\"/\",2),l=a[0];if(1<a.length){var u=this.parseRuleCodes(a[1]);\"NEEDAFFIX\"in this.flags&&-1!=u.indexOf(this.flags.NEEDAFFIX)||i(l,u);for(var c=0,h=u.length;c<h;c++){var f=u[c],p=this.rules[f];if(p)for(var d=this._applyRule(l,p),m=0,g=d.length;m<g;m++){var v=d[m];if(i(v,[]),p.combineable)for(var y=c+1;y<h;y++){var C=u[y],R=this.rules[C];if(R&&R.combineable&&p.type!=R.type)for(var b=this._applyRule(v,R),w=0,x=b.length;w<x;w++){i(b[w],[])}}}f in this.compoundRuleCodes&&this.compoundRuleCodes[f].push(l)}}else i(l.trim(),[])}}return n},_removeDicComments:function(e){return e=e.replace(/^\\t.*$/gm,\"\")},parseRuleCodes:function(e){if(!e)return[];if(!(\"FLAG\"in this.flags))return e.split(\"\");if(\"long\"!==this.flags.FLAG)return\"num\"===this.flags.FLAG?e.split(\",\"):void 0;for(var t=[],n=0,i=e.length;n<i;n+=2)t.push(e.substr(n,2));return t},_applyRule:function(e,t){for(var n=t.entries,i=[],s=0,r=n.length;s<r;s++){var o=n[s];if(!o.match||e.match(o.match)){var a=e;if(o.remove&&(a=a.replace(o.remove,\"\")),\"SFX\"===t.type?a+=o.add:a=o.add+a,i.push(a),\"continuationClasses\"in o)for(var l=0,u=o.continuationClasses.length;l<u;l++){var c=this.rules[o.continuationClasses[l]];c&&(i=i.concat(this._applyRule(a,c)))}}}return i},check:function(e){if(!this.loaded)throw\"Dictionary not loaded.\";var t=e.replace(/^\\s\\s*/,\"\").replace(/\\s\\s*$/,\"\");if(this.checkExact(t))return!0;if(t.toUpperCase()===t){var n=t[0]+t.substring(1).toLowerCase();if(this.hasFlag(n,\"KEEPCASE\"))return!1;if(this.checkExact(n))return!0}var i=t.toLowerCase();if(i!==t){if(this.hasFlag(i,\"KEEPCASE\"))return!1;if(this.checkExact(i))return!0}return!1},checkExact:function(e){if(!this.loaded)throw\"Dictionary not loaded.\";var t,n,i=this.dictionaryTable[e];if(void 0===i){if(\"COMPOUNDMIN\"in this.flags&&e.length>=this.flags.COMPOUNDMIN)for(t=0,n=this.compoundRules.length;t<n;t++)if(e.match(this.compoundRules[t]))return!0}else{if(null===i)return!0;if(\"object\"==typeof i)for(t=0,n=i.length;t<n;t++)if(!this.hasFlag(e,\"ONLYINCOMPOUND\",i[t]))return!0}return!1},hasFlag:function(e,t,n){if(!this.loaded)throw\"Dictionary not loaded.\";return!!(t in this.flags&&(void 0===n&&(n=Array.prototype.concat.apply([],this.dictionaryTable[e])),n&&-1!==n.indexOf(this.flags[t])))},alphabet:\"\",suggest:function(e,u){if(!this.loaded)throw\"Dictionary not loaded.\";if(u=u||5,this.memoized.hasOwnProperty(e)){var t=this.memoized[e].limit;if(u<=t||this.memoized[e].suggestions.length<t)return this.memoized[e].suggestions.slice(0,u)}if(this.check(e))return[];for(var n=0,i=this.replacementTable.length;n<i;n++){var s=this.replacementTable[n];if(-1!==e.indexOf(s[0])){var r=e.replace(s[0],s[1]);if(this.check(r))return[r]}}var c=this;function h(e,t){var n,i,s,r,o,a={};if(\"string\"==typeof e){var l=e;(e={})[l]=!0}for(var l in e)for(n=0,s=l.length+1;n<s;n++){var u=[l.substring(0,n),l.substring(n)];if(u[1]&&(o=u[0]+u[1].substring(1),t&&!c.check(o)||(o in a?a[o]+=1:a[o]=1)),1<u[1].length&&u[1][1]!==u[1][0]&&(o=u[0]+u[1][1]+u[1][0]+u[1].substring(2),t&&!c.check(o)||(o in a?a[o]+=1:a[o]=1)),u[1])for(i=0,r=c.alphabet.length;i<r;i++)c.alphabet[i]!=u[1].substring(0,1)&&(o=u[0]+c.alphabet[i]+u[1].substring(1),t&&!c.check(o)||(o in a?a[o]+=1:a[o]=1));if(u[1])for(i=0,r=c.alphabet.length;i<r;i++)o=u[0]+c.alphabet[i]+u[1],t&&!c.check(o)||(o in a?a[o]+=1:a[o]=1)}return a}return c.alphabet=\"abcdefghijklmnopqrstuvwxyz\",this.memoized[e]={suggestions:function(e){var t,n=h(e),i=h(n,!0);for(var s in n)c.check(s)&&(s in i?i[s]+=n[s]:i[s]=n[s]);var r=[];for(t in i)i.hasOwnProperty(t)&&r.push([t,i[t]]);r.sort(function(e,t){return e[1]<t[1]?-1:1}).reverse();var o=[],a=\"lowercase\";e.toUpperCase()===e?a=\"uppercase\":e.substr(0,1).toUpperCase()+e.substr(1).toLowerCase()===e&&(a=\"capitalized\");var l=u;for(t=0;t<Math.min(l,r.length);t++)\"uppercase\"===a?r[t][0]=r[t][0].toUpperCase():\"capitalized\"===a&&(r[t][0]=r[t][0].substr(0,1).toUpperCase()+r[t][0].substr(1)),c.hasFlag(r[t][0],\"NOSUGGEST\")||-1!=o.indexOf(r[t][0])?l++:o.push(r[t][0]);return o}(e),limit:u},this.memoized[e].suggestions}}}(),\"undefined\"!=typeof module&&(module.exports=Typo);";
}
